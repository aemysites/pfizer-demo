/* eslint-disable */ 
import{FranklinBlock,decorateCarouselScroller}from"../../scripts/lib-franklin.js";const filterAndMapNodes=(e,t)=>Array.from(e?.childNodes).filter((e=>e.nodeName===t)).map((e=>e.nodeName)),testForMediaMatch=async(e,t,n)=>{const r=Array.from(t?.childNodes).filter((e=>void 0!==e.nodeName&&"#text"!==e.nodeName)).map((e=>e.nodeName));if("textNodeOnly"!==e){if(1!==r.length||!t.querySelector(`${e}`))throw new Error(`Missing element match on non textNodeOnly: ${t?.parentElement} ${n}`);return}if(1!==filterAndMapNodes(t,"P").length)throw new Error(`Missing length match on : ${t?.parentElement} ${n}`)},validateCardType=async(e,t,n,r)=>{const{cardCollection:a}=e;if(!a)return void console.error("Card collection is missing",n);if("text-only"===t&&!r)throw console.error("text-only should not have any media",n,r),new Error("text-only should not have any media");if(r)return;const o=n.querySelectorAll(".card-before-render--media");await Promise.all(Array.from(o).map((async e=>{switch(t){case"image":await testForMediaMatch("picture",e,t);break;case"icon":await testForMediaMatch("span.icon",e,t);break;case"eyebrow":case"number":await testForMediaMatch("textNodeOnly",e,t);break;default:console.error("Card case not matched: ",e,t)}})))},truncateText=(e,t,n=!0)=>e.length>t?n?`${e.substring(0,t)}...`:e.substring(0,t):e,updateCharacterLength=(e,t)=>{const{cardCollection:n}=e;n.forEach((e=>{e?.heading&&e?.body&&(e.heading=e.heading.replace(/<(h[2-4])([^>]*)>(.*?)<\/\1>/g,((e,t,n,r)=>{if(!e)return e;return`<${t}${n}>${truncateText(r,60,!1)}</${t}>`})),e.body.length>130&&(e.body=truncateText(e.body,130,!0)),"eyebrow"===t&&(e.cardIdentifier=e.cardIdentifier.replace(/<(h[2-4]|p)([^>]*)>(.*?)<\/\1>/g,((e,t,n,r)=>{if(!e)return e;if(r.length>30){return`<${t}${n}>${truncateText(r,30,!1)}</${t}>`}return`<${t}${n}>${r}</${t}>`}))),"number"===t&&(e.cardIdentifier=e.cardIdentifier.replace(/<(h[2-4]|p)([^>]*)>(.*?)<\/\1>/g,((e,t,n,r)=>{if(!e)return e;if(r.length>6){return`<${t}${n}>${truncateText(r,6,!1)}</${t}>`}return`<${t}${n}>${r}</${t}>`}))),e.ctaLink?.length>30&&(e.ctaLink=truncateText(e.ctaLink,30)))}))},wrapTopMediaText=e=>{const t=e.querySelector(".card-before-render--media"),n=Array.from(t.childNodes).filter((e=>""!==e?.textContent.trim()&&e.nodeType===Node.TEXT_NODE));if(1===n.length){const e=n[0].textContent.trim(),r=document.createElement("p");r.classList.add("before-render-paragraph"),r.textContent=e,t.innerHTML="",t.appendChild(r)}};export default class Cards extends FranklinBlock{variants=[{name:"image",test:this.block.classList.contains("image")},{name:"icon",test:this.block.classList.contains("icon")},{name:"eyebrow",test:this.block.classList.contains("eyebrow")},{name:"number",test:this.block.classList.contains("number")},{name:"text-only",test:!0}];isSingleColumn=!1;isCarousel=!1;async beforeBlockDataRead(){this.isCarousel=this.block.outerHTML.includes("core-carousel-cards"),Array.from(this.block.children).forEach((e=>{if(![1,2].includes(e?.children.length))return void console.error("Minimum 1 row for cards",this.block);e.classList.add("card-div-target");2===e?.children.length?(e.children[0].classList.add("card-before-render--media"),e.children[1].classList.add("card-before-render--content"),this.isSingleColumn=!1,"number"!==this.variant&&"eyebrow"!==this.variant||wrapTopMediaText(e)):(e.children[0].classList.add("card-before-render--content"),this.block.classList.add("text-only","single-row-column"),this.isSingleColumn=!0)}))}async beforeBlockRender(){try{const{inputData:e,variant:t,block:n,isSingleColumn:r}=this;await validateCardType(e,t,n,r);const a=this.block.classList.contains("button-link-icon");this.inputData.variantButtonIcon=a,updateCharacterLength(this.inputData,t)}catch(e){console.error("Error validating card type",this.block),this.inputData=null}}async htmlMarkupUpdates(){try{const{variant:e,block:t}=this;t.querySelectorAll(".core-cards-top").forEach((t=>{t?.firstElementChild&&t.firstElementChild.classList.add(`top-${e}`)}))}catch(e){console.error("Error adjusting card type",this.block)}}async htmlGridUpdates(){const e=this.block.querySelectorAll("ul li");this.block.querySelectorAll("ul").forEach((e=>{e.classList.add("core-grid-parent")})),!e||e.length<2?console.log("cards require 2 minimum items",e):this.block.classList.add(`core-grid-${e.length>=4?3:e.length}`)}async afterBlockRender(){this.isCarousel&&decorateCarouselScroller(this.block.querySelector(".core-cards-inside ul")),await this.htmlMarkupUpdates(),await this.htmlGridUpdates()}}export const schema='{\n  "cards": {\n    "type": "Cards",\n    "description": "This is a Cards block description",\n    "schema": {\n      "classes": ["image", "number", "eyebrow", "icon", "button-link-icon"],\n      "cardCollection": {\n        "type": "multiple",\n        "description": "card examples",\n        "subTarget": ".card-div-target",\n        "items": {\n          "cardIdentifier": {\n            "selector": ".card-before-render--media",\n            "target": "innerHTML",\n            "optional": true\n          },\n          "ctaHref": {\n            "selector": ".card-before-render--content a",\n            "target": "href",\n            "optional": true\n          },\n          "ctaLink": {\n            "selector": ".card-before-render--content a",\n            "target": "textContent",\n            "optional": true\n          },\n          "heading": {\n            "selector": ".card-before-render--content h2, .card-before-render--content h3, .card-before-render--content h4",\n            "target": "outerHTML",\n            "optional": true\n          },\n          "body": {\n            "selector": ".card-before-render--content h2 + p, .card-before-render--content h3 + p, .card-before-render--content h4 + p",\n            "target": "textContent",\n            "optional": true\n          }\n        }\n      }\n    }\n  }\n}\n';export const template=' \n  <div class="core-cards-inside block-inside">\n    <ul>\n      {{ #cardCollection }}\n        <li class="core-cards-card core-cards-content">\n\n          {{! the cardIdentifier can be: image | icon | number | eyebrow }}\n\n          {{#cardIdentifier}}\n            <div class="core-cards-top">\n              {{ cardIdentifier }}\n            </div>\n          {{/cardIdentifier}}\n\n          <div class="core-cards-bottom standard-block-content-spacing core-cards-bottom-stretch">\n            <div>\n              {{ heading }}\n              <p>{{ body }}</p>\n            </div>\n            <p class="button-container" data-button-icon="{{ variantButtonIcon}}">\n              {{ #ctaHref }}\n              <a href="{{ ctaHref }}" title="{{ ctaLink }}" class="button secondary {{#variantButtonIcon}}button-icon{{/variantButtonIcon}}">\n                {{#variantButtonIcon}}\n                  <span class="icon icon-lib-chevron-right"></span>\n                {{/variantButtonIcon}}\n                {{^variantButtonIcon}}\n                <span> {{ ctaLink }} </span>\n                {{/variantButtonIcon}}\n              </a>\n              {{ /ctaHref }}\n            </p>\n          </div>\n        </li>\n      {{ /cardCollection }}\n    </ul>\n\n      {{! error display for mismatched data }}\n      {{^cardCollection}}\n        <div class="card-block-error"> There was an issue with missing required block data which prevented the Card from loading. </div>\n      {{/cardCollection}}\n  </div>\n';export const smartCaptureConfig=" {}";