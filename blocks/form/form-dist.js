/* eslint-disable */ 
import{Env}from"../../env.js";import{FranklinBlock,toClassName,decorateIcons,loadCSS,getAvailableChildrenRow,decorateSections,decorateDefaultContent,decorateBlocks,loadBlocks}from"../../scripts/lib-franklin.js";import Select from"../../scripts/lib-franklin/select.js";const FORMS_API_ENDPOINT_PROD="https://ms-forms-service-production.digitalpfizer.com/api/v2/forms",FORMS_API_ENDPOINT_UAT="https://ms-forms-service-uat.digitalpfizer.com/api/v2/forms",CONFIG_WORKFLOW_ENDPOINT_PROD="https://webforms.pfizer/api/get-config",CONFIG_WORKFLOW_ENDPOINT_UAT="https://autumn-smoke-staging.digitalpfizer.com/api/get-config";let useWorkflow=!1;const formsConfigApiRequest=async(e,t="GET",a=null,r=!1,s="")=>{const n=new Headers,o=`${r?CONFIG_WORKFLOW_ENDPOINT_UAT:CONFIG_WORKFLOW_ENDPOINT_PROD}/${e}`;n.append("x-client-environment",s);return await fetch(o,{method:t,headers:n,body:a})},formsApiRequest=async(e,t="GET",a=null,r=!1)=>{const s=new Headers;s.append("x-config-token",e);const n=r?FORMS_API_ENDPOINT_UAT:FORMS_API_ENDPOINT_PROD;return await fetch(n,{method:t,headers:s,body:a})};async function getConfigData(e,t,a){if(!useWorkflow)return{configToken:e,configData:null};const r=await formsConfigApiRequest(e,"GET",null,a,t);if(200!==r.status){const t=await r.json();if(t?.message)throw new Error(`${t?.message}`);throw new Error(`Error loading webform: ${e}`)}const s=await r.json();return{configToken:s.configToken,configData:s?.config?.fields}}async function getFormData(e,t){const a=await formsApiRequest(e,"GET",null,t);if(200!==a.status){const t=await a.json();if(t?.message)throw new Error(`${t?.message}`);throw new Error(`Error loading webform: ${e}`)}const r=await a.json();return{formData:r?.data?.fields,csrfToken:r?.data?.csrfToken}}const getFormsEnv=()=>Env.isLive()||Env.isProd()?"production":"non-production",fetchBuilderForm=async(e,t,a,r)=>{try{const s=getFormsEnv(),{configData:n,configToken:o}=await getConfigData(e,s,r),{formData:c,csrfToken:i}=await getFormData(o,r),l=n||c,d={submitTo:r?FORMS_API_ENDPOINT_UAT:FORMS_API_ENDPOINT_PROD,configToken:o,csrfToken:i,formEnv:s};let u=!1;return d.data=l.filter((e=>"html"!==e.type||"html"===e.type&&e.html)).map((e=>{if("submit"===e.type)return u=!0,{...e,type:"submit",placeholder:"",format:"",mandatory:"",options:"",rules:"",successPage:t,successRedirect:a};let r="";e.validators&&(r=e.validators.find((e=>"required"===e.type))?"x":"");const s={...e,mandatory:r,placeholder:e.placeholder||""};if("html"===e.type&&(s.html=e.html),"button"===e.type){if(!e?.attributes)return console.error("missing attributes for button",e),s;const r=e?.attributes.find((e=>"purpose"===Object.keys(e)[0]&&"primary"===Object.values(e)[0]));r&&!u&&(u=!0,s.type="submit",s.successPage=t,s.successRedirect=a)}return s})),d}catch(e){return console.error("Error fetching form",e),{error:e.message}}},constructPayload=e=>{const t={};return[...e.querySelectorAll("[name]")].forEach((e=>{const{name:a,value:r}=e;if(e.type.startsWith("select"))e.options[e.selectedIndex].disabled||(t[a]=r);else if("checkbox"===e.type)e.checked&&(t[a]?t[a]=[...t[a],r]:t[a]=r);else if("radio"===e.type)e.checked&&(t[a]=r);else if("date"===e.type){if(r){const e=r.replace(/-/g,"/"),s=new Date(e);t[a]=`${s.getMonth()+1}-${s.getDate()}-${s.getFullYear()}`}}else"hidden"===e.type?r&&(t[a]=r):a&&(t[a]=r)})),t},validateRequiredFields=e=>{const t=e.querySelectorAll("[required]"),a=[];return t.forEach((e=>{e.value||a.push({[e.name]:"This field is required."})})),a},submitForm=async e=>{try{const t=constructPayload(e),{csrfToken:a,configToken:r}=e.dataset;t.csrfToken=a;const s=validateRequiredFields(e);if(s.length>0)return{success:!1,status:400,payload:{errors:[{detailObj:s}]}};const n=await fetch(e.dataset.action,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json","x-config-token":r},body:JSON.stringify(a?t:{data:t})});return{success:n.status<400,status:n.status,payload:await n.json()}}catch(e){return console.error("Error submitting form",e),null}},toggleEnabledButtons=(e,t=!1)=>{e.querySelectorAll("button.primary, button.secondary").forEach((e=>{e.hasAttribute("disabled")||t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}))},checkSectionValidity=(e,t)=>{const a=t.map((e=>Object.keys(e)[0]));return!e.getAttribute("data-multistep-field-ids").split(",").some((e=>a.includes(e.trim())))};async function checkValidity(e,t=null){let a=t;if(!t){const t=e.closest("form");if(!t)return"";toggleEnabledButtons(t,!1),a=await submitForm(t),toggleEnabledButtons(t,!0)}const r=e.getAttribute("name"),s=a?.payload.errors?.[0]?.detailObj;if(s){return{currentError:s?.find((e=>Object.keys(e)[0]===r))?.[r]??""}}return null}function handleValidationError(e,t){if(!t)return;if(t.classList.remove("is-invalid"),t.querySelector(".error-message")?.remove(),""===e||!e)return;const a=document.createElement("small");a.classList.add("error-message"),a.textContent=e,t.classList.contains("core-form-textarea-wrapper")?t.querySelector(".counter-wrapper").append(a):t.append(a),t.classList.add("is-invalid")}const checkState=async(e,t=!0)=>{const a=e.closest(".core-form-field-wrapper");if(a?.classList.toggle("has-value",!!e.value),a?.classList.toggle("is-disabled",e.disabled),"checkbox"!==e.type&&"radio"!==e.type||a?.classList.add("is-dirty"),t){const t=await checkValidity(e);handleValidationError(t?.currentError,e.closest(".core-form-field-wrapper"))}};async function validateInputs(e,t){try{let a=t;if(t||(toggleEnabledButtons(e.closest("form"),!1),a=await submitForm(e.closest("form")),toggleEnabledButtons(e.closest("form"),!0)),a){if(e.querySelectorAll("input, select, textarea").forEach((async(e,t)=>{checkState(e,!1),e.parentElement?.classList.add("is-dirty");const r=e.closest(".core-form-field-wrapper"),s=await checkValidity(e,a);s&&(handleValidationError(s.currentError,r),0===t&&e.focus()),r?.classList.add("is-dirty"),r?.classList.add("is-validated")})),e.classList.contains("core-form-section")){const t=!a.payload.errors?.[0]||checkSectionValidity(e,a.payload.errors[0].detailObj);return e.classList.toggle("is-valid",t),t}return t.success}}catch(e){console.error("Error submitting form",e)}return null}const lastStepValidatorId="last_step_validator_field",validateLastSection=async e=>{const t=e.querySelector(`#${lastStepValidatorId}`);t&&(t.value="true")},submitFormListener=async(e,t)=>{e.addEventListener("click",(async a=>{a.preventDefault();const r=a.currentTarget.closest("form")??document.getElementById(a.currentTarget.getAttribute("form"));if(!r)return void console.error("missing form element");"submit"===e.type&&validateLastSection(r);const s=r.closest(".core-form");toggleEnabledButtons(r,!1);const n=await submitForm(r);if(n?.success){const e=`${t.successPage||"/forms/thank-you"}`;if(r.parentElement?.classList.remove("form-errors"),!0===t?.successRedirect)setTimeout((()=>{window.location.href=`${e}`}),1e3);else{s.classList.add("form-success"),s.innerHTML="";const t=await fetch(`${e}.plain.html`),a=await t.text(),r=document.createElement("div");r.innerHTML=a,decorateSections(r),decorateDefaultContent(r),decorateBlocks(r),loadBlocks(r);s.closest(".section").insertAdjacentElement("afterend",r)}}else validateInputs(r,n),toggleEnabledButtons(r,!0);toggleEnabledButtons(r,!0)}))},createButton=e=>{const t=document.createElement("button"),a=document.createElement("span");if(a.textContent=e.label,t.append(a),t.classList.add("button"),t.type=e.type||"",t.id=e.id||"",t.name=e.name||"",e?.attributes?.forEach((e=>{e?.class?.trim().split(" ").forEach((e=>{t.classList.add(e)})),t.classList.add("primary")})),"submit"===e.type&&submitFormListener(t,e),e.icon){t.className="has-icon";const a=document.createElement("span");a.className=`icon icon-${e.icon}`,t.append(a)}return t},createHeading=e=>{const t=document.createElement("h3");return t.textContent=e.label,t},createCopy=e=>{const t=document.createElement("span");if("*"===e.label.charAt(0)){const a=document.createElement("span");a.textContent="*",a.classList.add("required"),e.label=e.label.slice(1),t.append(a)}return t.textContent=e.label,t},createLabel=e=>{const t=document.createElement("label");return t.setAttribute("for",e.name||e.field),t.textContent=e.label,"x"===e.mandatory&&t.classList.add("required"),e.reversed&&t.classList.add("reversed"),t},toggleFieldWrapperFocused=(e,t,a,r="on")=>{const s=t.toUpperCase(),n=a.toLowerCase();if(e.target.tagName!==s||e.target.type!==n)return;const o=e.target.closest(".field-wrapper");o&&("on"===r?o?.classList.add("child-input-focused"):o?.classList.remove("child-input-focused"))},checkOnFocused=(e,t,a)=>{e instanceof FocusEvent&&toggleFieldWrapperFocused(e,t,a)},checkOnBlurLeave=(e,t,a)=>{e instanceof FocusEvent&&toggleFieldWrapperFocused(e,t,a,"off")},constFieldTypeAccessiblity=(e,t)=>{const a=e=>{if(!(e instanceof FocusEvent))return;const t=e.type,a=e.target.type;"focus"===t?checkOnFocused(e,"input",a):"blur"===t&&checkOnBlurLeave(e,"input",a)};["text","email","number","password","date","time"].includes(t)&&(e.addEventListener("focus",a),e.addEventListener("blur",a))},setRequiredAttributes=(e,t,a)=>{e.required=a,e.setAttribute("aria-required",String(Boolean(t)))},isMandatory=e=>"x"===e.mandatory,setAriaLabelledBy=(e,t)=>{["email","number"].includes(t.type)&&e.setAttribute("aria-labelledby",`${t.name}-label`)},createInput=e=>{const t=document.createElement("input");return t.type=e.type,t.id=e.name||e.field,t.setAttribute("name",e.name),e.placeholder&&t.setAttribute("placeholder",e.placeholder),setAriaLabelledBy(t,e),e.value&&(t.value=e.value),setRequiredAttributes(t,isMandatory(e),isMandatory(e)),["email","number"].includes(e.type)&&t.setAttribute("aria-labelledby",`${e.name}-label`),e.attributes&&e.attributes.forEach((e=>{if("string"==typeof e)t.setAttribute(e,e);else{const[a,r]=Object.entries(e)[0];t.setAttribute(a,r)}})),t.addEventListener("blur",(async()=>{await checkState(t,!1),t.parentElement?.classList.add("is-dirty"),t.closest(".core-form-field-wrapper")?.classList.add("is-dirty")})),t.addEventListener("input",(()=>{const e=t.closest(".core-form-field-wrapper");e?.classList.remove("is-validated"),e?.classList.remove("is-invalid")})),checkState(t,!0),constFieldTypeAccessiblity(t,e.type),t},formatOptionsArray=e=>{if("string"==typeof e){const t=[];return e.split(",").forEach((e=>{t.push({label:e.trim(),value:e.trim()})})),t}return e},wrapSelections=(e,t=[])=>{const a=[];return t.forEach(((t,r)=>{const s=document.createElement("div");s.className=`${e.type}-wrapper`;const n=`${toClassName(e.name)}-${r}`,o=createInput({type:e.type,field:n,value:t.value});o.setAttribute("name",e.name),o.setAttribute("id",n);const c=createLabel({field:n,label:t.label});c.setAttribute("for",n),s.append(o,c),a.push(s)})),a},toggleSelectComboBoxFocused=(e,t,a="on")=>{if(!(e instanceof FocusEvent))return;if(!t?.hasAttribute("role")||!t?.hasAttribute("class")||"combo-input"!==t.getAttribute("class")||"combobox"!==t.getAttribute("role"))return;const r=t.closest(".field-wrapper");r?.classList.add("field-wrapper-focused--select"),"on"===a?r?.classList.add("combo-input-focused"):r?.classList.remove("combo-input-focused")},createSelect=e=>{const t=document.createElement("input");t.type="text",t.id=e.name,t.name=e.name,t.setAttribute("name",e.name),t.style.display="none",t.classList.add("hidden");const a=new Select(null,(a=>{t.value=e.options[a].value,checkState(t,!1)}),{options:e.options.map((e=>e.value)),customSelectedOptions:e.options.map((e=>e.label)),disabledOptions:e.options.map((e=>!!e.disabled)),name:e.name,label:e.label,icon:"fpo",defaultMessage:"Select an option",required:isMandatory(e),reversed:e.reversed},null);return a.init(),a.el.append(t),a?.comboEl.addEventListener("focus",(e=>{toggleSelectComboBoxFocused(e,e.target)})),a?.comboEl.addEventListener("blur",(async e=>{toggleSelectComboBoxFocused(e,e.target,"off"),await checkState(t,!1),setTimeout((()=>{const e=t.closest(".core-form-field-wrapper");e?.classList.add("is-dirty"),e?.classList.remove("is-validated")}),0)})),a.el},createSelections=e=>wrapSelections(e,formatOptionsArray(e.options)),createCheckbox=e=>{e.type="checkbox",e.label??=e.name,e.value??=!0;const t=createInput(e);t.setAttribute("aria-live","polite"),t.setAttribute("aria-label","Unchecked"),t.setAttribute("aria-checked","false"),t.addEventListener("change",(()=>{const e=t.checked,a=e?"Checked":"Unchecked";t.setAttribute("aria-label",a),t.setAttribute("aria-checked",e)})),setRequiredAttributes(t,!0,isMandatory(e));const a=document.createElement("div");a.classList.add("checkbox-wrapper");const r=createLabel(e);return a.append(r),a.prepend(t),a},createCheckboxes=e=>{e.type="checkbox";const t=wrapSelections(e,formatOptionsArray(e.options));return t.forEach((e=>{const t=e.querySelector('input[type="checkbox"]');t.setAttribute("aria-live","polite"),t.setAttribute("aria-label","Unchecked"),t.setAttribute("aria-checked","false"),t.addEventListener("change",(()=>{const e=t.checked,a=e?"Checked":"Unchecked";t.setAttribute("aria-label",a),t.setAttribute("aria-checked",e)}))})),t},createSupport=e=>{const t=document.createElement("small");return t.textContent=e.support,t},createCounter=e=>{const t=document.createElement("small");t.classList.add("counter");const a=()=>{t.textContent=`${e.value.length.toString().padStart(2,"0")}/${100..toString().padStart(3,"0")}`};return e.addEventListener("input",(()=>{a(),e.closest(".core-form-field-wrapper")?.classList.remove("is-validated")})),a(),t},createTextArea=(e,t)=>{const a=document.createElement("textarea");a.id=e.name,a.setAttribute("name",e.name),e.placeholder&&a.setAttribute("placeholder",e.placeholder),e.value&&(a.value=e.value),setRequiredAttributes(a,!0,isMandatory(e)),setAriaLabelledBy(a,e),"x"===e.mandatory&&(a.required=!0),a.addEventListener("blur",(async()=>{await checkState(a,!1),a.closest(".field-wrapper").classList.add("is-dirty")})),a.addEventListener("input",(()=>{checkState(a,!1)}));const r=document.createElement("div");r.classList.add("textarea-container"),r.append(a),t.append(r);const s=document.createElement("div");s.classList.add("counter-wrapper"),e.support&&s.append(createSupport(e)),s.append(createCounter(a)),t.append(s)},applyRules=(e,t)=>{const a=constructPayload(e);t.forEach((t=>{const{type:r,condition:{key:s,operator:n,value:o}}=t.rule;if("visible"===r&&"eq"===n){const r=e.querySelector(`.${t.fieldId}`);a[s]===o?r.classList.remove("hidden"):r.classList.add("hidden")}}))},addFormItemWrapperClass=(e,t)=>{e.classList.add(`core-form-${t}-wrapper`)},configureNumberInput=(e,t)=>{if(t.step&&(e.step=t.step),t?.validators){const a=t.validators.find((e=>"minValue"===e.type));a&&(e.min=a.value);const r=t.validators.find((e=>"maxValue"===e.type));r&&(e.max=r.value)}},restructureJson=e=>{if(!e)return e;const t=e.reduce(((e,t)=>({...e,[t.name]:t})),{});e.forEach((e=>{"section"===e.type&&e.childFieldRefs&&(e.children=e.childFieldRefs.map((e=>t[e])))}));const a=e.filter((e=>"section"===e.type)).map((e=>e.childFieldRefs)).flat();return e.forEach((e=>{a.includes(e.name)&&"section"!==e.type&&(e.isNested="true")})),e},applyFieldJsonOption=(e,t)=>{const a=`variant-${e?.type}-${e?.variant}`;t.classList.add(a),t.querySelectorAll("input, textarea, select").forEach((t=>{t.setAttribute("data-field-variant",e?.variant)}))},createField=e=>{e.type=e.type||"text";const t=document.createElement("div"),a=e.style?` form-${e.style}`:"",r=`core-form-${e.type}-wrapper${a}`;t.className=r,t.classList.add("field-wrapper"),t.classList.add("core-form-field-wrapper"),e.section&&(t.dataset.section=e.section);["checkboxes","radio","checkbox","select"].includes(e.type)?t.classList.add("field-label-position-relative"):t.classList.add("field-label-position-absolute"),e?.variant&&t.setAttribute("data-core-form-variant","true");const s=e=>{e.variant||(e.variant="default")};switch(e.type){case"heading":t.append(createHeading(e));break;case"copy":t.append(createCopy(e));break;case"select":e.reversed=t.closest(".core-form")?.classList.contains("reversed"),e.label&&t.append(createLabel(e)),t.append(createSelect(e)),addFormItemWrapperClass(t,e.type),e.support&&t.append(createSupport(e)),e.reversed&&t.classList.add("reversed");break;case"checkbox":s(e),t.append(createCheckbox(e)),addFormItemWrapperClass(t,e.type);break;case"checkboxes":s(e),e.label&&t.append(createLabel(e)),t.append(...createCheckboxes(e));break;case"radio":e.label&&t.append(createLabel(e)),t.append(...createSelections(e));break;case"textarea":e.label&&t.append(createLabel(e)),createTextArea(e,t);break;case"date":case"time":e.label&&t.append(createLabel(e)),t.append(createInput(e)),addFormItemWrapperClass(t,e.type),e.support&&t.append(createSupport(e));break;case"button":case"submit":t.classList.add("form-button-wrapper"),t.append(createButton(e));break;case"honeypot":e.type="hidden",t.append(createInput(e)),addFormItemWrapperClass(t,"hidden");break;case"hidden":t.append(createInput(e)),addFormItemWrapperClass(t,"hidden");break;case"html":if(e?.html){t.classList.add("form-html-wrapper"),t.classList.add("default-content-wrapper"),t.innerHTML=e.html;t.querySelectorAll("p").forEach((e=>{if("*"===e.textContent.charAt(0)){const t=document.createElement("span");t.textContent="*",t.classList.add("required"),e.textContent=e.textContent.slice(1),e.prepend(t)}}))}break;case"section":console.error("Section field type should not be rendered"),t.innerHTML="";break;case"number":e.label&&t.append(createLabel(e)),t.append(createInput(e)),addFormItemWrapperClass(t,"text"),e.support&&t.append(createSupport(e)),configureNumberInput(t.querySelector("input"),e);break;default:e.label&&t.append(createLabel(e)),t.append(createInput(e)),addFormItemWrapperClass(t,"text"),e.support&&t.append(createSupport(e))}return e?.variant&&applyFieldJsonOption(e,t),t},multiStepFormInteractions=(e,t,a,r,s=!1)=>{const n=e;if(Array.from(n).find((e=>0===e.querySelectorAll("button").length)))throw new Error("Div with data-section-multistep-index does not contain any buttons");n.setAttribute("data-section-multistep-index",a),n.setAttribute("data-multistep-field-ids",t.children.map((e=>e.name)).join(","));const o=t?.label??`Step ${a+1}`,c=document.createElement("div");c.classList.add("section-multistep-label"),c.textContent=o,n.prepend(c);const i=document.createElement("span");i.classList.add("icon","icon-lib-check-circle"),c.append(i),s&&n.classList.add("last-section"),0===a&&n.setAttribute("data-section-is-active","true"),s||n.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(async()=>{const t=r.querySelectorAll("[data-section-multistep-index]"),s=e.closest(".core-form-section-multistep");if(!await validateInputs(s))return;const n=a+1;t.forEach(((e,t)=>{t===n?(e.setAttribute("data-section-is-active","true"),e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):e.setAttribute("data-section-is-active","false")}))}))}))},createForm=async(e,t)=>{const a=document.createElement("form");a.setAttribute("novalidate",!0);const r=document.createElement("div");r.classList.add("core-form-container"),a.append(r);const s=[];a.dataset.action=e.submitTo,a.dataset.csrfToken=e.csrfToken,a.dataset.configToken=e.configToken,a.dataset.formEnv=e.formEnv;const n=restructureJson(e?.data),o=n.filter((e=>"section"===e.type));return n.forEach((e=>{if("true"===e.isNested)return;if("section"===e.type){const{children:s}=e;if(!s)return;const n=document.createElement("div"),c="multi-step-form-ui"===t?"core-form-section-multistep core-form-section":"core-form-section-inline core-form-section";if(n.className=c,n.dataset.sectionName=e.name,n.dataset.section="",s.forEach((e=>{const t=createField(e);n.append(t)})),"multi-step-form-ui"===t){const e=n.getAttribute("data-section-name"),t=o.find((t=>t.name===e)),r=o.findIndex((t=>t.name===e)),s=r===o.length-1;multiStepFormInteractions(n,t,r,a,s),a.setAttribute("data-active-section",0)}return void r.append(n)}const s=createField(e);r.append(s)})),a.addEventListener("change",(()=>applyRules(a,s))),applyRules(a,s),a};function setupIcons(e){const t=["icon-lib-mat-error-round","icon-lib-mat-warning","icon-lib-mat-check-circle","icon-lib-input-clear"];e.querySelectorAll(".core-form-field-wrapper").forEach((e=>{const a=e.querySelector("input, textarea, select, option"),r=a?.classList?.contains("hidden");if(!r){if(!a)return;let r=e;e.classList.contains("core-form-textarea-wrapper")&&(r=e.querySelector(".textarea-container")),t.forEach((e=>{const t=document.createElement("span");t.className=`icon ${e}`,r.append(t)}))}})),decorateIcons(e),e.querySelectorAll(".icon-lib-input-clear").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".field-wrapper").querySelector("input, select");t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),t.focus()}))}))}const markupCallback=async(e,t,a=!1)=>{const{token:r,successPage:s,successRedirect:n,additionalStyles:o,formName:c,stagingActive:i}=e;if(!r)return console.error("Missing token in form configuration"),null;t.textContent="";const l="TRUE"===i&&!Env.isLive(),d=await fetchBuilderForm(r,s,n,l);if(d?.error)return t.classList.add("form-error"),t.innerHTML=`<span class="icon icon-warning"></span><p>${d.error}</p>`,null;const u=await createForm(d,a);return t.append(u),setupIcons(t),c&&t.classList.add(c),o&&await loadCSS(o),t};export default class Form extends FranklinBlock{constructor(e,t){super(e,t),this.formConfiguration={},this.scrollableText=null,this.hasTermsOfService=!1}variants=[{name:"multi-step-form-ui",test:this.block.classList.contains("multistep")},{name:"default",test:!0}];formatScrollableCheckboxHtml(){if(!this.hasTermsOfService)return;const e=document.querySelector(".variant-checkbox-scrollable"),t=document.createElement("div");t.innerHTML=this.scrollableText,t.classList.add("scrollable-text-container");const a=document.createElement("div");a.textContent="Consent",a.classList.add("consent-container"),e&&e.parentNode&&(e.parentNode.insertBefore(t,e),e.parentNode.insertBefore(a,t));const r=document.querySelectorAll('.variant-checkbox-scrollable input[type="checkbox"]');r.forEach((e=>{e.disabled=!0}));t.addEventListener("scroll",(()=>{var e;(e=t).scrollHeight-e.scrollTop===e.clientHeight&&r.forEach((e=>{e.disabled=!1}))}))}static formatToggleCheckboxHtml(){const e=document.querySelectorAll('[class*="variant-checkbox-toggle-"] .checkbox-wrapper');let t=0;e.forEach((e=>{const a=document.createElement("div");a.className="on-or-off-text",a.textContent="Off";const r=e.querySelector('input[type="checkbox"]'),s=e.querySelector("label");if(r&&s&&r.parentNode===e){if(r.parentNode!==e)return void console.error("input element is not a child of checkbox wrapper",r);e.insertBefore(s,r);const n=document.createElement("div");n.className="toggle-wrapper";const o=document.createElement("input");o.type="checkbox",o.id=`toggle-${t}`,o.className="toggle-checkbox";const c=document.createElement("label");c.setAttribute("for",`toggle-${t}`),c.className="toggle-label",c.setAttribute("tabindex","0"),c.addEventListener("keydown",(e=>{if("Enter"===e.key){e.preventDefault();const t=document.querySelector(`#${c.getAttribute("for")}`);t.checked=!t.checked,t.dispatchEvent(new Event("change"))}}));const i=document.createElement("span");i.className="toggle-knob",c.appendChild(i),n.appendChild(o),n.appendChild(c),n.appendChild(a),r.replaceWith(n),t+=1}}))}static handleToggleCheckboxFormInput(){document.querySelectorAll(".toggle-checkbox").forEach((e=>{const t=e.closest(".checkbox-wrapper").querySelector("label"),a=()=>{e.disabled?t.classList.add("disabled-label"):t.classList.remove("disabled-label")};a();new MutationObserver(a).observe(e,{attributes:!0,attributeFilter:["disabled"]}),e.addEventListener("change",(e=>{e.target.closest(".checkbox-wrapper").querySelector(".on-or-off-text").textContent=e.target.checked?"On":"Off"}))}))}setWorkflow(e){e&&(e.endsWith("__wd")||(useWorkflow=!0))}async beforeBlockDataRead(){const e=this.findSectionContent("terms_of_service");e&&(this.scrollableText=e.innerHTML,this.scrollableText&&(this.hasTermsOfService=!0)),this.formConfiguration.token=getAvailableChildrenRow(this.block,"token")?getAvailableChildrenRow(this.block,"token").textContent.trim():null,this.setWorkflow(this.formConfiguration.token),this.formConfiguration.successPage=getAvailableChildrenRow(this.block,"success_page")?getAvailableChildrenRow(this.block,"success_page").textContent.trim():null,this.formConfiguration.successRedirect=getAvailableChildrenRow(this.block,"success_redirect")?getAvailableChildrenRow(this.block,"success_redirect").textContent.trim():null,this.formConfiguration.additionalStyles=getAvailableChildrenRow(this.block,"additional_styles")?getAvailableChildrenRow(this.block,"additional_styles").textContent.trim():null,this.formConfiguration.formName=getAvailableChildrenRow(this.block,"form_name")?getAvailableChildrenRow(this.block,"form_name").textContent.trim():null,this.formConfiguration.stagingActive=getAvailableChildrenRow(this.block,"staging_active")?getAvailableChildrenRow(this.block,"staging_active").textContent.trim():null}async afterBlockRender(){await markupCallback(this.formConfiguration,this.block,this.variant),Form.formatToggleCheckboxHtml(),this.formatScrollableCheckboxHtml(),Form.handleToggleCheckboxFormInput(),this.block.classList.add("block-padding-standard")}}export const schema='{\n  "form": {\n    "name": "Form block",\n    "description": "This is just a wrapping block to form block",\n    "schema": {\n      "classes": ["column-2", "column-two", "multistep", "dividers"],\n      "initialHtml": {\n        "selector": ":scope > div",\n        "target": "innerHTML"\n      }\n    }\n  }\n}\n';export const template=' <div class="core-form-content-target">\n  {{ initialHtml }}\n</div>';export const smartCaptureConfig=" {}";